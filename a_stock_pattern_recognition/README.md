# A股股票形态识别量化交易系统

## 项目概述

本系统通过波动率过滤技术，识别K线图中的真正高低点，为A股交易提供精准的入场和出场信号。

## 系统架构

### 1. 核心模块设计

#### 1.1 数据处理模块 (data_handler)
- **数据获取**：对接A股数据源（如Tushare、聚宽等）
- **数据预处理**：清洗异常值、处理停牌数据、复权处理
- **数据存储**：使用SQLite/MySQL存储历史数据，Redis缓存实时数据

#### 1.2 技术指标模块 (indicators)
- **波动率指标**
  - ATR（真实波幅）
  - 历史波动率（HV）
  - Bollinger Bands宽度
  - 动态波动率阈值
  
- **辅助指标**
  - 成交量加权指标
  - 价格动量指标
  - 市场微观结构指标

#### 1.3 形态识别模块 (pattern_recognition)
- **高低点识别算法**
  - 基于局部极值的初步识别
  - 波动率过滤器（剔除噪音）
  - 时间窗口验证
  - 成交量确认
  
- **形态模式**
  - 头肩顶/底
  - 双顶/双底
  - 三角形态
  - 旗形/楔形

#### 1.4 交易信号模块 (trading)
- **入场信号**
  - 突破确认（价格+成交量）
  - 回踩支撑位
  - 形态完成信号
  
- **出场信号**
  - 止盈目标（基于形态测算）
  - 止损位置（基于波动率）
  - 动态跟踪止损

#### 1.5 回测引擎 (backtest)
- **回测框架**
  - 事件驱动回测
  - 滑点和手续费模拟
  - 资金管理
  
- **性能评估**
  - 收益率分析
  - 风险指标（夏普比率、最大回撤等）
  - 交易统计

#### 1.6 可视化模块 (visualization)
- K线图标注（高低点、形态）
- 交易信号展示
- 回测结果分析图表

## 核心算法设计

### 2.1 波动率过滤的高低点识别

```
算法流程：
1. 计算滚动窗口内的局部极值点
2. 计算每个极值点的波动率环境
3. 设定动态阈值：threshold = median_volatility * factor
4. 过滤规则：
   - 高点：当前高点 > 前高点 + threshold
   - 低点：当前低点 < 前低点 - threshold
5. 时间验证：极值点需要保持N个周期
6. 成交量确认：伴随成交量放大
```

### 2.2 动态波动率计算

```
1. ATR基础波动率 = MA(TR, period)
2. 百分比波动率 = ATR / Close * 100
3. 自适应窗口 = f(market_condition)
4. 综合波动率 = weighted_avg(ATR_vol, HV, BB_width)
```

### 2.3 交易策略逻辑

```
入场条件：
- 识别到有效低点 + 价格突破前高
- 波动率处于合理区间
- 成交量确认
- 技术指标共振

出场条件：
- 达到形态测算目标
- 跌破关键支撑位
- 波动率异常放大
- 持仓时间超限
```

## 风险控制

### 3.1 仓位管理
- 单只股票最大仓位：20%
- 基于波动率的仓位调整
- 凯利公式优化

### 3.2 止损策略
- 固定止损：-2%
- 波动率止损：-2*ATR
- 时间止损：持仓超过N天未达预期

### 3.3 市场环境过滤
- 大盘趋势判断
- 板块轮动分析
- 系统性风险监控

## 实施计划

### 第一阶段：基础功能
1. 数据获取和存储
2. 波动率计算
3. 基础高低点识别

### 第二阶段：核心算法
1. 波动率过滤器优化
2. 形态识别完善
3. 交易信号生成

### 第三阶段：策略优化
1. 参数优化
2. 机器学习增强
3. 实盘测试

## 技术栈
- Python 3.8+
- pandas, numpy (数据处理)
- TA-Lib (技术指标)
- matplotlib, plotly (可视化)
- SQLite/MySQL (数据存储)
- backtrader/zipline (回测框架)

## 注意事项
1. A股T+1交易制度的影响
2. 涨跌停板的处理
3. 停牌和复牌的数据处理
4. 分红送股的复权处理